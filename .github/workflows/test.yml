name: test

on:
  push:
    branches:
      - feature-e2e-gh

jobs:
  cypress-run:
    name: Cypress run
    runs-on: ubuntu-latest
    env:
      CORTEZA_VERSION: 2022.3.4
      CYPRESS_VERSION: 9.5.1
      CYPRESS_HOST: http://corteza
      CYPRESS_BASE_URL: http://corteza
      CYPRESS_ADMIN_URL: http://corteza/admin
      CYPRESS_COMPOSE_URL: http://corteza/compose
      CYPRESS_WORKFLOW_URL: http://corteza/workflow
      CYPRESS_REPORTER_URL: http://corteza/reporter
      CYPRESS_ONE_URL: http://corteza/one
      CYPRESS_USER_EMAIL: cypress@test.com
      CYPRESS_USER_EMAIL_NEW: permissions@email.com
      CYPRESS_USER_PASSWORD: cypress123
      CYPRESS_USER_PASSWORD_NEW: newcypress123

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Pull corteza
        run: docker pull cortezaproject/corteza:${CORTEZA_VERSION}

      - uses: actions/checkout@v3
        with:
          repository: cortezaproject/corteza-e2e-cypress
          path: ./cypress

      - name: Run corteza
        run: docker-compose -f cypress/.github/docker-compose.yaml --project-directory cypress up -d corteza

      - name: Run dockerized Cypress
        run: docker-compose -f cypress/.github/docker-compose.yaml --project-directory cypress up --exit-code-from cypress

      # - name: Setup upterm session
      #   uses: lhotari/action-upterm@v1
